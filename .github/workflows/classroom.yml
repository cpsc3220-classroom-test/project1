name: GitHub Classroom Workflow

on: [push]

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  get-test:
    name: get-test 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: ${{ secrets.REPO }}
          token: ${{ secrets.ACCESS_TOKEN }}
      - uses: actions/upload-artifact@v2
        with:
          name: test
          path: .
  set-up-test:
    name: set-up-test
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v3
      - name: script
        run: |
          sudo apt-get update
          sudo apt-get install valgrind
          chmod +x ./handout/install-riscv-tools.sh
          ./handout/install-riscv-tools.sh
        shell: bash
      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - run: pip install -r ${GITHUB_WORKSPACE}/.github/classroom/requirement.txt
      - uses: actions/download-artifact@v2
      - run: ls -la ./test
      - run: ls -la ./test/testfiles
      - run: ls -la ~/.local
      - run: echo $PATH
      - run: riscv64-unknown-elf-gcc --version
      - uses: education/autograding@v1 
      #  set-up-xv6:
      #    runs-on: ubuntu-latest
      #    steps:
      #    - uses: actions/checkout@v3
      #    - name: script
      #      run: |
      #        chmod +x ./handout/install-riscv-tools.sh
      #        ./handout/install-riscv-tools.sh
      #      shell: bash
 
        #  set-up-python:
        #    name: set-up-python 
        #    needs: get-test
        #    runs-on: ubuntu-latest
        #    steps:
        #      - uses: actions/checkout@v3
        #      - uses: actions/setup-python@v4
        #        with:
        #          python-version: '3.9'
        #      - run: pip install -r ${GITHUB_WORKSPACE}/.github/classroom/requirement.txt
        #      - uses: actions/download-artifact@v2
        #      - run: ls
        #  test:
        #    needs: [set-up-python,set-up-xv6]
        #    name: Autograding
        #    runs-on: ubuntu-latest
        #    steps:
        #      - uses: actions/checkout@v3
        #      - uses: actions/download-artifact@v2
        #      - uses: education/autograding@v1 
